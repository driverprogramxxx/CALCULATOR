<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sum Inputs</title>
    <style>
        body {
            background-color: #2a2a2a;
            color: #f1f1f1;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        form {
            background-color: #333333;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 600px;
            color: #ffffff;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        input {
            padding: 5px;
            width: 95px;
            border: none;
            border-radius: 5px;
            background-color: #444444;
            color: #ffffff;
        }
        .highlight {
            border: 2px solid #4CAF50;
            padding: 10px;
            background-color: #333333;
            width: fit-content;
            border-radius: 5px;
            margin: 20px auto 0;
            text-align: left;
        }
        #calculationDetails {
            color: #b0f2b4;
            margin-top: 10px;
            white-space: pre-line;
        }
        #totalSum, #distanceUsed {
            color: #FFD700;
        }
        button {
            margin-top: 10px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <form id="sumForm">
        <h2>วิ่ง 1 ช่วงให้กรอก 1 ช่อง, วิ่ง 2 ช่วงให้กรอก 2 ช่อง</h2>
        
        <label for="grab">GRAB:</label>
        <div class="input-group">
            <input type="number" id="grab1" name="GRAB1" placeholder="GRAB 1" oninput="calculateSum()">
            <input type="number" id="grab2" name="GRAB2" placeholder="GRAB 2" oninput="calculateSum()">
        </div>

        <label for="bolt">BOLT:</label>
        <div class="input-group">
            <input type="number" id="bolt1" name="BOLT1" placeholder="BOLT 1" oninput="calculateSum()">
            <input type="number" id="bolt2" name="BOLT2" placeholder="BOLT 2" oninput="calculateSum()">
        </div>

        <label for="indriver">INDRIVER:</label>
        <div class="input-group">
            <input type="number" id="indriver1" name="INDRIVER1" placeholder="INDRIVER 1" oninput="calculateSum()">
            <input type="number" id="indriver2" name="INDRIVER2" placeholder="INDRIVER 2" oninput="calculateSum()">
        </div>

        <label for="maxim">MAXIM:</label>
        <div class="input-group">
            <input type="number" id="maxim1" name="MAXIM1" placeholder="MAXIM 1" oninput="calculateSum()">
            <input type="number" id="maxim2" name="MAXIM2" placeholder="MAXIM 2" oninput="calculateSum()">
        </div>

        <label for="others">งานนอก:</label>
        <div class="input-group">
            <input type="number" id="others1" name="OTHERS1" placeholder="OTHERS 1" oninput="calculateSum()">
            <input type="number" id="others2" name="OTHERS2" placeholder="OTHERS 2" oninput="calculateSum()">
        </div>

        <label for="electricity">ค่าไฟ:</label>
        <div class="input-group">
            <input type="number" id="electricity1" name="ELECTRICITY1" placeholder="Electricity 1" oninput="calculateSum()">
            <input type="number" id="electricity2" name="ELECTRICITY2" placeholder="Electricity 2" oninput="calculateSum()">
        </div>

        <label for="startKm">ระยะทางเริ่มต้น (กม.):</label>
        <div class="input-group">
            <input type="number" id="startKm1" name="STARTKM1" placeholder="Start KM 1" oninput="calculateDistance()">
            <input type="number" id="startKm2" name="STARTKM2" placeholder="Start KM 2" oninput="calculateDistance()">
        </div>

        <label for="endKm">ระยะทางสิ้นสุด (กม.):</label>
        <div class="input-group">
            <input type="number" id="endKm1" name="ENDKM1" placeholder="End KM 1" oninput="calculateDistance()">
            <input type="number" id="endKm2" name="ENDKM2" placeholder="End KM 2" oninput="calculateDistance()">
        </div>

        <div class="highlight">
            <div id="calculationDetails"></div>
            <h2 id="totalSum">รวมยอดที่ต้องโอน: 0 บาท</h2>
            <h2 id="distanceUsed">ระยะทางที่ใช้: 0 กม.</h2>
            <div id="dateTime"></div>
        </div>

        <button type="button" onclick="resetForm()">รีเซ็ตข้อมูล</button>
    </form>

    <script>
        // โหลดข้อมูลจาก localStorage
        window.onload = function() {
            const fields = ['grab1', 'grab2', 'bolt1', 'bolt2', 'indriver1', 'indriver2', 'maxim1', 'maxim2', 'others1', 'others2', 'electricity1', 'electricity2', 'startKm1', 'startKm2', 'endKm1', 'endKm2'];
            fields.forEach(field => {
                const value = localStorage.getItem(field);
                if (value) {
                    document.getElementById(field).value = value;
                }
            });
            calculateSum();
            calculateDistance();
        };

        // เซฟข้อมูลไปยัง localStorage
        function saveToLocalStorage() {
            const fields = ['grab1', 'grab2', 'bolt1', 'bolt2', 'indriver1', 'indriver2', 'maxim1', 'maxim2', 'others1', 'others2', 'electricity1', 'electricity2', 'startKm1', 'startKm2', 'endKm1', 'endKm2'];
            fields.forEach(field => {
                const value = document.getElementById(field).value;
                localStorage.setItem(field, value);
            });
        }

        // คำนวณยอดรวม
        function calculateSum() {
            saveToLocalStorage(); // บันทึกข้อมูลทุกครั้งที่มีการคำนวณ
            const services = ['grab', 'bolt', 'indriver', 'maxim', 'others'];
            let calculationText = "";
            let incomeSum1 = 0, incomeSum2 = 0;

            services.forEach(service => {
                const amount1 = parseFloat(document.getElementById(service + '1').value) || 0;
                const amount2 = parseFloat(document.getElementById(service + '2').value) || 0;
                incomeSum1 += amount1;
                incomeSum2 += amount2;
                if (amount1 > 0 || amount2 > 0) {
                    calculationText += `${service.toUpperCase()}: `;
                    if (amount2 > 0) {
                        calculationText += `${amount1} + ${amount2} = ${(amount1 + amount2).toFixed(2)} บาท\n`;
                    } else {
                        calculationText += `${amount1.toFixed(2)} บาท\n`;
                    }
                }
            });

            const electricity1 = parseFloat(document.getElementById('electricity1').value) || 0;
            const electricity2 = parseFloat(document.getElementById('electricity2').value) || 0;
            let totalIncome = incomeSum1 + incomeSum2;
            let maintenanceFee = totalIncome * 0.1;
            let remainingIncome = totalIncome - maintenanceFee;
            let totalElectricity = electricity1 + electricity2;
            remainingIncome -= totalElectricity;

            // สรุปยอดคำนวณ
            calculationText += `ยอดรวมรายได้: ${incomeSum1.toFixed(2)} + ${incomeSum2.toFixed(2)} = ${totalIncome.toFixed(2)} บาท\n`;
            calculationText += `ลบค่า maintenance 10% (${maintenanceFee.toFixed(2)} บาท): [คงเหลือ ${remainingIncome + totalElectricity} บาท]\n`;
            calculationText += `ลบค่าไฟ ${electricity1.toFixed(2)} + ${electricity2.toFixed(2)} = ${totalElectricity.toFixed(2)} บาท [คงเหลือ ${remainingIncome.toFixed(2)} บาท]\n`;

            // คำนวณหารครึ่ง
            if (remainingIncome > 0) {
                const halfAmount = remainingIncome / 2;
                calculationText += `หารครึ่ง: ${remainingIncome.toFixed(2)} / 2 = ${halfAmount.toFixed(2)} บาท\n`;
                calculationText += `บวก maintenance 10% ที่ลบไป: ${(halfAmount + maintenanceFee).toFixed(2)} บาท`;
                document.getElementById('totalSum').innerText = `รวมยอดที่ต้องโอน: ${(halfAmount + maintenanceFee).toFixed(2)} บาท`;
            } else {
                calculationText += `\n`;
                document.getElementById('totalSum').innerText = `รวมยอดที่ต้องโอน: 0 บาท`;
            }

            document.getElementById('calculationDetails').innerText = calculationText;
        }

        // คำนวณระยะทาง
        function calculateDistance() {
            saveToLocalStorage(); // บันทึกข้อมูลทุกครั้งที่มีการคำนวณ
            let startKm1 = parseFloat(document.getElementById('startKm1').value) || 0;
            let startKm2 = parseFloat(document.getElementById('startKm2').value) || 0;
            let endKm1 = parseFloat(document.getElementById('endKm1').value) || 0;
            let endKm2 = parseFloat(document.getElementById('endKm2').value) || 0;

            let distanceUsed1 = endKm1 - startKm1;
            let distanceUsed2 = endKm2 - startKm2;
            let totalDistance = distanceUsed1 + distanceUsed2;

            let distanceCalculation = 'ระยะทางที่ใช้: ';

            // แสดงเฉพาะผลลัพธ์สุดท้าย
            if (distanceUsed1 > 0 || distanceUsed2 > 0) {
                if (distanceUsed1 > 0 && distanceUsed2 > 0) {
                    distanceCalculation += `${distanceUsed1.toFixed(2)} + ${distanceUsed2.toFixed(2)} = ${totalDistance.toFixed(2)} กม.`;
                } else if (distanceUsed1 > 0) {
                    distanceCalculation += `${distanceUsed1.toFixed(2)} กม.`;
                } else if (distanceUsed2 > 0) {
                    distanceCalculation += `${distanceUsed2.toFixed(2)} กม.`;
                }
            } else {
                distanceCalculation += '0 กม.';
            }

            document.getElementById('distanceUsed').innerText = distanceCalculation;
        }

        // รีเซ็ตข้อมูล
        function resetForm() {
            const fields = ['grab1', 'grab2', 'bolt1', 'bolt2', 'indriver1', 'indriver2', 'maxim1', 'maxim2', 'others1', 'others2', 'electricity1', 'electricity2', 'startKm1', 'startKm2', 'endKm1', 'endKm2'];
            fields.forEach(field => {
                document.getElementById(field).value = '';
                localStorage.removeItem(field); // ลบข้อมูลจาก localStorage
            });
            document.getElementById('calculationDetails').innerText = '';
            document.getElementById('totalSum').innerText = 'รวมยอดที่ต้องโอน: 0 บาท';
            document.getElementById('distanceUsed').innerText = 'ระยะทางที่ใช้: 0 กม.';
        }

        // อัปเดตวันที่และเวลา
        function updateDateTime() {
            let now = new Date();
            let options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit', 
                timeZone: 'Asia/Bangkok'
            };
            let dateTimeString = now.toLocaleDateString('th-TH', options);
            document.getElementById('dateTime').innerText = dateTimeString;
        }

        setInterval(updateDateTime, 1000);
    </script>

</body>
</html>
